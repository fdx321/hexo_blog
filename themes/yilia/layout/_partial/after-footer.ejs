<% if (theme.fancybox){ %>
  <%- css('fancybox/jquery.fancybox') %>
<% } %>

<script>
	var yiliaConfig = {
		fancybox: <%=theme.fancybox%>,
		mathjax: <%=theme.mathjax%>,
		animate: <%=theme.animate%>,
		isHome: <%=is_home()%>,
		isPost: <%=is_post()%>,
		isArchive: <%=is_archive()%>,
		isTag: <%=is_tag()%>,
		isCategory: <%=is_category()%>,
		open_in_new: <%=theme.open_in_new%>
	}
</script>
<%- js('https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min') %>
<%- js('js/main') %>


<%- partial('google-analytics') %>

<% if (theme.mathjax){ %>
<%- partial('mathjax') %>
<% } %>
<!--page counter part-->
<script>
function addCount (Counter) {
        var query1=new AV.Query(Counter);
        query1.equalTo("url","totalCount");
        query1.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("url","totalCount");
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                          console.log('New object created');
                        },
                        error: function(newcounter,error){
                          console.log('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                console.log('Error:'+error.code+" "+error.message);
            }
        });

        url=$('.article-date').attr('href').trim();
        title = $('.article-title').text().trim();
        var query2=new AV.Query(Counter);
        query2.equalTo("url",url);
        query2.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("title",title);
                    newcounter.set("url",url);
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                          console.log('New object created');
                        },
                        error: function(newcounter,error){
                          console.log('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                console.log('Error:'+error.code+" "+error.message);
            }
        });
}
$(function(){
        var Counter=AV.Object.extend("Counter");
        //only increse visit counting when intering a page
        if ($('.article-title').length == 1){
           addCount(Counter);
         }

        var query=new AV.Query(Counter);
        query.equalTo("url","totalCount");
        query.find({
            success: function(results){
              $('#access-count').text(results[0].get('time'));
            },
            error: function(error){
                console.log("Error:"+error.code+" "+error.message);
            }
        });
});
</script>
